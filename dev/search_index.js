var documenterSearchIndex = {"docs":
[{"location":"api/#Library","page":"API","title":"Library","text":"","category":"section"},{"location":"api/#Types","page":"API","title":"Types","text":"","category":"section"},{"location":"api/","page":"API","title":"API","text":"\tSad.Dingman\n\tSad.Rectangular","category":"page"},{"location":"api/#Sad.Dingman","page":"API","title":"Sad.Dingman","text":"Dingman river channel cross section.\n\nUses generalized expressions for cross-section geometry based on at-a-station hydraulic geometry relations.\n\nWb: bankfull width\nYb: bankfull depth\nYm: flow depth\nr: geometry exponent\nS0: bed slope\nn: Manning roughness coefficient\n\nSee also: Rectangular\n\n\n\n\n\n","category":"type"},{"location":"api/#Sad.Rectangular","page":"API","title":"Sad.Rectangular","text":"Rectangular river channel cross section.\n\nWb: bankfull width\nYb: bankfull depth\nYm: flow depth\nS0: bed slope\nn: Manning roughness coefficient\n\nSee also: Dingman\n\n\n\n\n\n","category":"type"},{"location":"api/#Functions","page":"API","title":"Functions","text":"","category":"section"},{"location":"api/#Cross-sections","page":"API","title":"Cross sections","text":"","category":"section"},{"location":"api/","page":"API","title":"API","text":"\tSad.width\n\tSad.depth","category":"page"},{"location":"api/#Sad.width","page":"API","title":"Sad.width","text":"width(xs)\n\nCalculate water surface width of cross section.\n\nArguments\n\nxs: cross section\n\n\n\n\n\n","category":"function"},{"location":"api/#Sad.depth","page":"API","title":"Sad.depth","text":"depth(xs)\n\nCalculate average depth of cross section.\n\nArguments\n\nxs: cross section\n\n\n\n\n\n","category":"function"},{"location":"api/#Priors","page":"API","title":"Priors","text":"","category":"section"},{"location":"api/","page":"API","title":"API","text":"\tSad.get_samples\n\tSad.lhs_ensemble\n\tSad.prior_ensemble\n\tSad.gvf_ensemble!\n\tSad.rejection_sampling\n\tSad.priors","category":"page"},{"location":"api/#Sad.get_samples","page":"API","title":"Sad.get_samples","text":"get_samples(p, samples)\n\nGet quantiles from p according to weights provided by Latin Hypercube Sampling samples.\n\n\n\n\n\n","category":"function"},{"location":"api/#Sad.lhs_ensemble","page":"API","title":"Sad.lhs_ensemble","text":"lhs_ensemble(nens, args...)\n\nGenerate an ensemble of size nens using Latin Hypercube Sampling of the list of distributions or collections provided as args.\n\n\n\n\n\n","category":"function"},{"location":"api/#Sad.prior_ensemble","page":"API","title":"Sad.prior_ensemble","text":"prior_ensemble(x::Vector{Float64}, Qp::Distribution, np::Distribution, rp::Distribution, zp::Distribution, nens::Int)\n\nGenerate a prior ensemble of discharge, roughness coefficient, channel shape parameter, and downstream bed elevation from provided distributions or sample data.\n\nArguments\n\nx: distances between cross sections\nQp: discharge prior distribution\nnp: roughness coefficient distribution\nrp: channel shape parameter distribution\nzp: downstream bathymetry distribution\nnens: ensemble size\n\n\n\n\n\n","category":"function"},{"location":"api/#Sad.gvf_ensemble!","page":"API","title":"Sad.gvf_ensemble!","text":"gvf_ensemble!(H::Vector{Float64}, S, x::Vector{Float64}, hbf::Vector{Float64}, wbf::Vector{Float64}, Qe::Vector{Float64}, ne::Vector{Float64}, re::Vector{Float64}, ze)\n\nGenerate an ensemble of water height profiles from Gradually-Varied-Flow simulations and associated profiles of bed elevation.\n\nH: water surface elevation\nS: bed slope\nx: channel chainage\nhbf: bankfull water surface elevation\nwbf: bankfull width\nQe: ensemble discharge\nne: ensemble roughness coefficient\nre: ensemble channel shape parameter\nze: ensemble bed elevation profiles\n\n\n\n\n\n","category":"function"},{"location":"api/#Sad.rejection_sampling","page":"API","title":"Sad.rejection_sampling","text":"rejection_sampling(Qp, np, rp, zp, x, H, S0, hbc, wbf, hbf, nens)\n\nUse rejection sampling to select a subset of the prior ensemble.\n\nArguments\n\nQp: prior discharge distribution\nnp: prior roughness coefficient distribution\nrp: prior channel shape parameter distribution\nzp: prior distribution for downstream bed elevation\nx: channel chainage\nH: time series of observed water surface elevation profiles\nS0: prior estimate of channel bed slope\nhbc: mean downstream flow depth used as boundary condition\nwbf: bankfull width\nhbf: bankfull water surface elevation\nnens: ensemble size\n\n\n\n\n\n","category":"function"},{"location":"api/#Sad.priors","page":"API","title":"Sad.priors","text":"priors(ncfile)\n\nDerive prior distributions for discharge, roughness coefficient, channel shape parameter, and bed elevation by reading the SWORD a-priori database.\n\nArguments\n\nncfile: NetCDF file of SWORD database\n\n\n\n\n\npriors(qwbm, hmin)\n\nDerive distributions for discharge, roughness coefficient, channel shape parameter, and bed elevation using uninformative priors.\n\nArguments\n\nqwbm: mean discharge\nhmin: minimum downstream water surface elevation\n\n\n\n\n\n","category":"function"},{"location":"api/#Kalman-filters","page":"API","title":"Kalman filters","text":"","category":"section"},{"location":"api/","page":"API","title":"API","text":"\tSad.letkf","category":"page"},{"location":"api/#Sad.letkf","page":"API","title":"Sad.letkf","text":"letkf(A::Matrix{Float64}, d::Vector{Float64}, HA::Matrix{Float64}, E::Matrix{Float64}, ρ::Float64, diagR::Bool)\n\nApply the Local Ensemble Transform Kalman Filter algorithm.\n\nArguments\n\nA: state variable ensemble matrix\nd: observation vector\nHA: model-predicted observation ensemble matrix\nE: observation error ensemble matrix\nρ: covariance inflation parameter (optional, default value of 1.05)\ndiagR: force observation error covariance to be diagonal, i.e. no spatial correlation (optional, default is false)\n\n\n\n\n\n","category":"function"},{"location":"api/#Gradually-Varied-Flow","page":"API","title":"Gradually Varied Flow","text":"","category":"section"},{"location":"api/","page":"API","title":"API","text":"\tSad.froude\n\tSad.dydx\n\tSad.gvf","category":"page"},{"location":"api/#Sad.froude","page":"API","title":"Sad.froude","text":"froude(Q::Float64, xs::CrossSection)\n\nCalculate the Froude number.\n\nArguments\n\nQ: discharge\nxs: cross section\n\n\n\n\n\n","category":"function"},{"location":"api/#Sad.dydx","page":"API","title":"Sad.dydx","text":"dydx(y, p, x)\n\nOrdinary differential equation describing the Gradually-Varied-Flow model.\n\n\n\n\n\n","category":"function"},{"location":"api/#Sad.gvf","page":"API","title":"Sad.gvf","text":"Calculate a water surface profile by solving the Gradually-Varied-Flow equation.\n\nQ: discharge\nybc: downstream boundary condition for depth\nS0: bed slope for reach\nn: roughness coefficient\nx: downstream distance for each cross section\nwbf: bankfull width for each cross section\nybf: bankfull depth for each cross section\nr: channel geometry coefficient for each cross section\n\n\n\n\n\n","category":"function"},{"location":"api/#Sad","page":"API","title":"Sad","text":"","category":"section"},{"location":"api/","page":"API","title":"API","text":"\tSad.assimilate\n\tSad.bathymetry!","category":"page"},{"location":"api/#Sad.assimilate","page":"API","title":"Sad.assimilate","text":"assimilate(H::Vector{Float64})\n\nAssimilate SWOT observations for river reach.\n\nArguments\n\nH: water surface elevation\nW: water surface width\nx: downstream distance for each cross section\nwbf: bankfull width\nhbf: bankfull depth\nQₚ: prior probability distribution for discharge\nnₚ: prior probability distribution for roughness coefficient\nrₚ: prior probability distribution for channel shape parameter\nzₚ: prior distribution for downstream bed elevation\nnens: ensemble size\nϵₒ: observation error standard deviation\n\n\n\n\n\n","category":"function"},{"location":"api/#Sad.bathymetry!","page":"API","title":"Sad.bathymetry!","text":"bathymetry!(ze, Se, Qe, ne, re, x, hbf, wbf, H, ϵ₀::Float64=0.01)\n\nEstimate channel bed slope and thalweg (elevation) by assimilating SWOT water surface elevation observations.\n\nArguments\n\nze: ensemble of bed elevations\nSe: ensemble of bed slopes\nQe: ensemble of discharge\nne: ensemble of roughness coefficient\nre: ensemble of channel shape parameters\nx: channel chainage\nhbf: bankfull water surface elevation\nwbf: bankfull width\nH: time-averaged water surface elevation observed\nϵ₀: observation error standard deviation\n\n\n\n\n\n","category":"function"},{"location":"algorithm/#Algorithm","page":"Algorithm","title":"Algorithm","text":"","category":"section"},{"location":"algorithm/","page":"Algorithm","title":"Algorithm","text":"The SAD algorithm operates on the set of SWOT observables (i.e., WSE, width, and slope) and derives an estimate of river discharge and its associated uncertainty using a data assimilation scheme. The assimilation scheme involves the \"first-guess\" estimation of hydraulic variables by combining a forward model with a set of prior probability distributions before assimilating the SWOT observations. The priors are either acquired from the SWORD a-priori database or are derived using a data-driven approach (rejection sampling).","category":"page"},{"location":"algorithm/","page":"Algorithm","title":"Algorithm","text":"<img src=\"../assets/algorithm.jpg\" alt=\"algorithm\" width=\"50%\" class=\"center\">","category":"page"},{"location":"algorithm/#Hydraulic-model","page":"Algorithm","title":"Hydraulic model","text":"","category":"section"},{"location":"algorithm/","page":"Algorithm","title":"Algorithm","text":"The forward model in the assimilation scheme is based on the Gradually Varied Flow (GVF) equations, which describe the steady-state, non-uniform flow in river channels with gradual variations in water depth and velocity. The general form of the GVF equation is ","category":"page"},{"location":"algorithm/","page":"Algorithm","title":"Algorithm","text":"dfracdYdx = dfracS_0 - S_f1 - textFr^2","category":"page"},{"location":"algorithm/","page":"Algorithm","title":"Algorithm","text":"where Y is the average water depth, x is the longitudinal distance, S0 is the channel bed slope, Sf is the water surface slope, and Fr is the Froude number. ","category":"page"},{"location":"algorithm/#Cross-sections","page":"Algorithm","title":"Cross sections","text":"","category":"section"},{"location":"algorithm/#Data-assimilation","page":"Algorithm","title":"Data assimilation","text":"","category":"section"},{"location":"installation/#Installation","page":"Install","title":"Installation","text":"","category":"section"},{"location":"installation/","page":"Install","title":"Install","text":"The latest version of Sad.jl can be installed with Julia's built-in package manager. You can add the package and then run instantiate to install dependencies","category":"page"},{"location":"installation/","page":"Install","title":"Install","text":"import Pkg\nPkg.add(\"Sad\")\nPkg.instantiate()","category":"page"},{"location":"installation/","page":"Install","title":"Install","text":"Similarly the package can be updated ","category":"page"},{"location":"installation/","page":"Install","title":"Install","text":"Pkg.update(\"Sad\")","category":"page"},{"location":"installation/","page":"Install","title":"Install","text":"warn: Use Julia 1.6 or newer\nThe Sad.jl code has only been tested with Julia v1.6 and above, so please update your installation accordingly.","category":"page"},{"location":"use_cases/#Use-cases","page":"Use cases","title":"Use cases","text":"","category":"section"},{"location":"use_cases/#Pepsi-1-experiment","page":"Use cases","title":"Pepsi-1 experiment","text":"","category":"section"},{"location":"use_cases/","page":"Use cases","title":"Use cases","text":"We start by loading the data, including river node information and synthetic SWOT observations","category":"page"},{"location":"use_cases/","page":"Use cases","title":"Use cases","text":"    using NCDatasets, Statistics, Distributions, Sad\n    f = Dataset(\"../../data/pepsi1/Po.nc\")\n    g = NCDatasets.group(f, \"XS_Timeseries\")\n\tqwbm = NCDatasets.group(f, \"River_Info\")[\"QWBM\"][1]\n    x = (g[\"X\"][:][end] .- g[\"X\"][:])[end:-1:1, 1]\n    Q = g[\"Q\"][:][end:-1:1, :]\n    H = g[\"H\"][:][end:-1:1, :]\n    W = g[\"W\"][:][end:-1:1, :]","category":"page"},{"location":"use_cases/","page":"Use cases","title":"Use cases","text":"Bankfull width and water surface elevation can be guessed as the maximum from the observed time series, while an initial estimate of bed slope can be obtained from the mean of surface water slope","category":"page"},{"location":"use_cases/","page":"Use cases","title":"Use cases","text":"    hbf = maximum(H, dims=2)[:, 1]\n    wbf = maximum(W, dims=2)[:, 1]\n    S0 = mean(diff(H, dims=1) ./ diff(x), dims=2)[:, 1]\n    S0 = [S0[1]; S0]","category":"page"},{"location":"use_cases/","page":"Use cases","title":"Use cases","text":"Then we can derive the prior distributions using rejection sampling from uninformative priors","category":"page"},{"location":"use_cases/","page":"Use cases","title":"Use cases","text":"\tQp0, np0, rp0, zp0 = Sad.priors(qwbm, minimum(H[1, :]))\n\tQp, np, rp, zp = Sad.rejection_sampling(Qp0, np0, rp0, zp0, x, H, S0, mean(H[1, :]), wbf, hbf, 1000);","category":"page"},{"location":"use_cases/","page":"Use cases","title":"Use cases","text":"The ensemble of discharge, roughness coefficient, channel shape parameter and bed elevation can now be generated","category":"page"},{"location":"use_cases/","page":"Use cases","title":"Use cases","text":"\tQe, ne, re, ze = Sad.prior_ensemble(x, Qp, np, rp, zp, 1000);","category":"page"},{"location":"use_cases/","page":"Use cases","title":"Use cases","text":"Bed elevation and slope are then estimated by assimilating the time-average water surface elevation profile","category":"page"},{"location":"use_cases/","page":"Use cases","title":"Use cases","text":"\tS = diff(H, dims=1) ./ diff(x);\n    Se = repeat(S', outer=3)'[:, 1:1000];\n    Se = [Se[1, :]'; Se]\n    Sad.bathymetry!(ze, Se, Qe, ne, re, x, hbf, wbf, mean(H, dims=2)[:, 1])\n\tzp = Truncated(Normal(mean(ze[1, :]), std(ze[1, :])), -Inf, minimum(H[1, :]))","category":"page"},{"location":"use_cases/","page":"Use cases","title":"Use cases","text":"and finally we assimilate the observed water surface elevation to estimate discharge and flow parameters, which include roughness coefficient and minimum cross-sectional area","category":"page"},{"location":"use_cases/","page":"Use cases","title":"Use cases","text":"\tQa, na = assimilate(H, W, x, wbf, hbf, Se, Qp, np, rp, zp, nens)","category":"page"},{"location":"use_cases/#Confluence","page":"Use cases","title":"Confluence","text":"","category":"section"},{"location":"#Sad.jl-Documentation","page":"Home","title":"Sad.jl Documentation","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"","category":"page"},{"location":"","page":"Home","title":"Home","text":"The Surface Water Ocean Topography (SWOT) satellite mission that launched in December 2022 will offer a unique opportunity to map river discharge at an unprecedented spatial resolution globally from observations of water surface elevation, width, and slope. Because river discharge will not be directly observed from SWOT, a number of algorithms of varying complexity have been developed to estimate discharge from SWOT observables. The SAD algorithm operates on the set of SWOT observables (i.e., WSE, width, and slope) and derives an estimate of river discharge and its associated uncertainty using a data assimilation scheme. The assimilation scheme involves the “first‐guess” estimation of hydraulic variables by combining a forward model with a set of prior probability distributions before assimilating the SWOT observations. The priors are estimated with a sampling approach, as these data‐driven methods have shown promise in many fields. The objective of the algorithm is to estimate discharge at each river reach when SWOT observations become available.","category":"page"}]
}
